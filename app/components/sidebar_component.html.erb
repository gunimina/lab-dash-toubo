<aside id="sidebar" 
       class="w-64 bg-white dark:bg-gray-800 flex-shrink-0 rounded-l-xl transition-all duration-300"
       data-controller="sidebar"
       data-sidebar-collapsed-class="w-16"
       data-sidebar-expanded-class="w-64"
       data-turbo-permanent>
  
  <div class="flex flex-col h-full">
    <!-- Logo -->
    <div class="px-6 py-5">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center shadow-lg flex-shrink-0">
          <span class="text-white text-lg font-bold">✦</span>
        </div>
        <h1 class="text-xl font-semibold text-slate-900 dark:text-white transition-opacity duration-300"
            data-sidebar-target="text">Lab Dashboard</h1>
      </div>
    </div>
    
    <!-- Navigation -->
    <nav class="flex-1 px-3 py-4 space-y-1 overflow-hidden">
      <% navigation_items.each do |section| %>
        <div class="mb-1">
          <% if section[:items] %>
            <!-- Section Header -->
            <button class="w-full flex items-center justify-between px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 group <%= section_active?(section) ? 'bg-blue-50 dark:bg-blue-900/20' : '' %>"
                    data-action="click->sidebar#toggleSection"
                    data-sidebar-section-param="<%= section[:id] %>">
              <div class="flex items-center space-x-3">
                <%= lucide_icon(section[:icon], class: "w-5 h-5 flex-shrink-0 #{section_active?(section) ? 'text-blue-600 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400'}", data: { sidebar_target: "icon" }) %>
                <span class="transition-opacity duration-300" data-sidebar-target="text">
                  <%= section[:title] %>
                </span>
              </div>
              <span class="transition-all duration-200 <%= section_active?(section) ? 'rotate-180' : '' %>"
                    data-sidebar-target="text"
                    data-sidebar-chevron="<%= section[:id] %>">
                <%= lucide_icon("chevron-down", class: "w-4 h-4 #{section_active?(section) ? 'text-blue-600 dark:text-blue-400' : 'text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400'}") %>
              </span>
            </button>
            
            <!-- Section Items -->
            <div class="mt-1 space-y-1 overflow-hidden transition-all duration-200"
                 data-sidebar-section="<%= section[:id] %>"
                 style="<%= section_active?(section) ? 'max-height: 500px;' : 'max-height: 0;' %>">
              <% section[:items].each do |item| %>
                <% if item[:method] == :post %>
                  <%= link_to item[:path], 
                      class: "#{link_classes(false)} ml-8",
                      data: { 
                        turbo_method: :post, 
                        turbo_confirm: item[:confirm],
                        sidebar_target: "link"
                      } do %>
                    <%= lucide_icon(item[:icon], class: "w-4 h-4 flex-shrink-0", data: { sidebar_target: "icon" }) %>
                    <span class="transition-opacity duration-300" data-sidebar-target="text">
                      <%= item[:title] %>
                    </span>
                  <% end %>
                <% else %>
                  <%= link_to item[:path], 
                      class: "#{link_classes(is_active?(item[:path]))} ml-8",
                      data: { sidebar_target: "link" } do %>
                    <%= lucide_icon(item[:icon], class: "w-4 h-4 flex-shrink-0", data: { sidebar_target: "icon" }) %>
                    <span class="transition-opacity duration-300" data-sidebar-target="text">
                      <%= item[:title] %>
                    </span>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <!-- Single Item -->
            <%= link_to section[:path], 
                class: link_classes(is_active?(section[:path])),
                data: { sidebar_target: "link" } do %>
              <%= lucide_icon(section[:icon], class: "w-5 h-5 flex-shrink-0", data: { sidebar_target: "icon" }) %>
              <span class="transition-opacity duration-300" data-sidebar-target="text">
                <%= section[:title] %>
              </span>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </nav>
    
    <!-- Bottom Section -->
    <div class="px-3 py-4 mt-auto" data-sidebar-target="bottomSection">
      <!-- Theme Toggle -->
      <button onclick="toggleTheme()" 
              class="w-full flex items-center space-x-3 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
              data-sidebar-target="link">
        <span class="dark:hidden flex-shrink-0"><%= lucide_icon("sun", class: "w-5 h-5", data: { sidebar_target: "icon" }) %></span>
        <span class="hidden dark:block flex-shrink-0"><%= lucide_icon("moon", class: "w-5 h-5", data: { sidebar_target: "icon" }) %></span>
        <span class="transition-opacity duration-300" data-sidebar-target="text">테마 변경</span>
      </button>
    </div>
  </div>
</aside>
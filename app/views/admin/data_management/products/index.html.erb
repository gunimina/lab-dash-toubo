<% content_for :page_title, "상품 목록" %>

<div class="container mx-auto">
  <div class="mx-auto p-4" style="max-width: 1400px;">
    <div class="space-y-4">
  <!-- 검색 섹션 -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
    <%= form_with url: search_admin_data_management_products_path, method: :get, data: { turbo_frame: "product-results", turbo_action: "advance" }, class: "flex gap-4" do |f| %>
      <div class="flex-1">
        <%= f.text_field :q, 
            value: @search_query,
            placeholder: "상품명, 카탈로그 번호, Cat.No로 검색...", 
            class: "w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",
            data: { 
              controller: "search",
              action: "input->search#submit",
              search_target: "input"
            } %>
      </div>
      <%= f.submit "검색", class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium" %>
    <% end %>
  </div>

  <!-- 상품 목록 테이블 -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden">
    <turbo-frame id="product-results">
      <%= render 'product_table', products: @products %>
    </turbo-frame>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 검색 폼 자동 제출 (디바운스 적용)
  let searchTimeout;
  const searchInput = document.querySelector('[data-search-target="input"]');
  
  if (searchInput) {
    searchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        this.form.requestSubmit();
      }, 500);
    });
  }
});
</script>
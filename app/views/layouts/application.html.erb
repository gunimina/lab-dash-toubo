<!DOCTYPE html>
<html class="<%= cookies[:theme] == 'dark' ? 'dark' : '' %>">
  <head>
    <title><%= content_for(:page_title) || "Lab Dash Webhook" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Tailwind CSS -->
    <%= stylesheet_link_tag "tailwind" %>
    <%= stylesheet_link_tag "application" %>
    
    
    <!-- Import Maps with Turbo -->
    <%= javascript_importmap_tags %>
    
    <!-- Turbo configuration -->
    <script type="module">
      import { Turbo } from "@hotwired/turbo-rails"
      // Ensure Turbo is enabled
      Turbo.session.drive = true
    </script>
  </head>

  <body class="bg-slate-100 dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen p-4">
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow-xl border border-slate-200 dark:border-gray-800 h-[calc(100vh-2rem)] flex overflow-hidden" data-controller="sidebar">
      <!-- 사이드바 컴포넌트 -->
      <%= render SidebarComponent.new(current_path: request.path) %>
      
      <!-- Main Content -->
      <main class="flex-1 flex flex-col overflow-hidden rounded-r-2xl">
        <!-- Header -->
        <header class="px-6 py-4 flex items-center bg-[#f5f5f7] dark:bg-gray-900">
          <!-- 햄버거 메뉴 버튼 -->
          <button data-action="click->sidebar#toggle" 
                  class="mr-4 p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition-colors">
            <%= lucide_icon("menu", class: "w-6 h-6 text-gray-700 dark:text-gray-300") %>
          </button>
          
          <div class="flex-1">
            <%= section_header(
              content_for(:page_title) || "초기 크롤링",
              subtitle: Date.current.strftime("%Y년 %m월 %d일"),
              actions: render('shared/server_status', connected: @server_connected)
            ) %>
          </div>
        </header>
        
        <!-- Page Content -->
        <div class="flex-1 overflow-hidden bg-[#f5f5f7] dark:bg-gray-900">
          <div class="h-full overflow-y-auto scroll-smooth p-6">
            <% if flash[:notice] %>
              <%= alert_box(flash[:notice], type: :info) %>
            <% end %>
            <% if flash[:alert] %>
              <%= alert_box(flash[:alert], type: :error) %>
            <% end %>
            <% if flash[:success] %>
              <%= alert_box(flash[:success], type: :success) %>
            <% end %>
            <%= yield %>
          </div>
        </div>
      </main>
    </div>
    
    <!-- Theme Toggle Script -->
    <script>
      function toggleTheme() {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');
        
        if (isDark) {
          html.classList.remove('dark');
          document.cookie = 'theme=light;path=/;max-age=31536000';
        } else {
          html.classList.add('dark');
          document.cookie = 'theme=dark;path=/;max-age=31536000';
        }
      }
    </script>
  </body>
</html>

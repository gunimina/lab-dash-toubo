#!/bin/bash

echo "ğŸ”„ Rails ì„œë²„ ì¬ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸"

# ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
echo "1ï¸âƒ£ ê¸°ì¡´ Rails/Puma í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ..."
pkill -f "puma.*lab-dash-webhook" 2>/dev/null
pkill -f "rails server" 2>/dev/null

# PID íŒŒì¼ ì •ë¦¬
echo "2ï¸âƒ£ PID íŒŒì¼ ì •ë¦¬..."
rm -f tmp/pids/server.pid

# í¬íŠ¸ í™•ì¸
echo "3ï¸âƒ£ í¬íŠ¸ 7500 í™•ì¸..."
if lsof -i :7500 > /dev/null 2>&1; then
    echo "âš ï¸  í¬íŠ¸ 7500ì´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤."
    kill -9 $(lsof -t -i:7500) 2>/dev/null
fi

# ì ì‹œ ëŒ€ê¸°
sleep 1

# ì„œë²„ ì‹œì‘
echo "4ï¸âƒ£ Rails ì„œë²„ ì‹œì‘ (í¬íŠ¸ 7500)..."
bin/rails server

echo "âœ… ì™„ë£Œ!"